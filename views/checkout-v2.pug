doctype html
html
  head
    title Payment Page
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    meta(name="referrer" content="origin-when-crossorigin")
    link(rel='icon', href='https://github.com/shadcn.png', type='image/x-icon')
    link(rel="preconnect" href="https://fonts.googleapis.com")
    link(link rel="preconnect" href="https://fonts.gstatic.com" crossorigin)
    link(link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet")

    style.
      .font-regular {
      font-family: "Tajawal", sans-serif;
      font-weight: 400;
      font-style: normal;
      }

      .font-medium {
        font-family: "Tajawal", sans-serif;
        font-weight: 500;
        font-style: normal;
      }

      .font-bold {
        font-family: "Tajawal", sans-serif;
        font-weight: 700;
        font-style: normal;
      }

      .font-extrabold {
        font-family: "Tajawal", sans-serif;
        font-weight: 800;
        font-style: normal;
      }

      .btn-container{
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .flex {
        display: flex;
      }
      .flex-col {
        flex-direction: column;
      }
      .justify-center {
        justify-content: center;
      }
      .items-center {
        align-items: center;
      }
      .flex-start{
        justify-content: flex-start;
      }
      .flex-end{
        justify-content: flex-end
      }
      .w-full{
        width: 100%;
      }
      .justify-between{
        justify-content: space-between;
      }
      .bg-background{
        background-color: hsl(210, 40%, 98%);
      }
      .bg-white{
        background-color: white;
      }
      .gap-2 {
        gap: 4px;
      }
      .gap-3 {
        gap: 10px;
      }
      .p-3{
        padding: 6px;
      }
      #submitbutton,#card-v2{
      align-items:flex-center;
      background-attachment:scroll;background-clip:border-box;
      background-color:rgb(50, 50, 93);background-image:none;
      background-origin:padding-box;
      background-position-x:0%;
      background-position-y:0%;
      background-size:auto;
      border-bottom-color:rgb(255, 255, 255);
      border-bottom-left-radius:4px;
      border-bottom-right-radius:4px;border-bottom-style:none;
      border-bottom-width:0px;border-image-outset:0px;
      border-image-repeat:stretch;border-image-slice:100%;
      border-image-source:none;border-image-width:1;
      border-left-color:rgb(255, 255, 255);
      border-left-style:none;
      border-left-width:0px;
      border-right-color:rgb(255, 255, 255);
      border-right-style:none;
      border-right-width:0px;
      border-top-color:rgb(255, 255, 255);
      border-top-left-radius:4px;
      border-top-right-radius:4px;
      border-top-style:none;
      border-top-width:0px;
      box-shadow:rgba(50, 50, 93, 0.11) 0px 4px 6px 0px, rgba(0, 0, 0, 0.08) 0px 1px 3px 0px;
      box-sizing:border-box;color:rgb(255, 255, 255);
      cursor:pointer;
      display:block;
      float:left;
      font-family:"Helvetica Neue", Helvetica, sans-serif;
      font-size:15px;
      font-stretch:100%;
      font-style:normal;
      font-variant-caps:normal;
      font-variant-east-asian:normal;
      font-variant-ligatures:normal;
      font-variant-numeric:normal;
      font-weight:600;
      height:35px;
      letter-spacing:0.375px;
      line-height:35px;
      margin-bottom:0px;
      margin-left:12px;
      margin-right:0px;
      margin-top:28px;
      outline-color:rgb(255, 255, 255);
      outline-style:none;
      outline-width:0px;
      overflow-x:visible;
      overflow-y:visible;
      padding-bottom:0px;
      padding-left:14px;
      padding-right:14px;
      padding-top:0px;
      text-align:center;
      text-decoration-color:rgb(255, 255, 255);
      text-decoration-line:none;
      text-decoration-style:solid;
      text-indent:0px;
      text-rendering:auto;
      text-shadow:none;
      text-size-adjust:100%;
      text-transform:none;
      transition-delay:0s;
      transition-duration:0.15s;
      transition-property:all;
      transition-timing-function:ease;
      white-space:nowrap;
      width:150.781px;
      word-spacing:0px;
      writing-mode:horizontal-tb;
      -webkit-appearance:none;
      -webkit-font-smoothing:antialiased;
      -webkit-tap-highlight-color:rgba(0, 0, 0, 0);
      -webkit-border-image:none;
      }
      .payment-container{
        width: 100%;
        margin-left: auto;
        box-sizing: border-box;
        margin-right: auto;
        display: flex;
        flex-direction: column;
        gap: 20px;
        max-width: 500px;
        position: relative;
        background: inherit;
        pointer-events: auto;
        transition: 0.05s ease-out;
        }
        .line{
          height: 1px;
          width: 100%;
          background-color: lightgray
        }

  body.bg-background
    div.payment-container
      div.flex.justify-between
        span.font-bold #{amount}
        span.font-extrabold القيمة 
      span.line
      div.flex.justify-between
        span.font-bold #{amount_without_vat}
        span.font-extrabold المجموع باستثناء. الضريبة 
      div.flex.justify-between
        span.font-bold #{vat_percent_amount}
        span.font-extrabold الضريبة %10
      div.flex.justify-between
        span.font-bold #{refund_guarantee}
        span.font-extrabold ضمان استرداد الأموال
      div.flex.justify-between
        span.font-bold #{amount_with_vat}
        span.font-extrabold المجموع شاملاً الضريبة
      div.flex.flex-end
        span.font-bold اختار طريقة الدفع
    div#card-sdk-id 
    div.btn-container
      button#card-v2(onclick="window.CardSDK.tokenize()") تأكيد

    // Link to external JavaScript (placed before closing body tag)
    script(src="https://tap-sdks.b-cdn.net/card/1.0.2/index.js")
    script.
      document.addEventListener('DOMContentLoaded', function() {
        const { renderTapCard, Theme, Currencies, Direction, Edges, Locale, tokenize, resetCardInput, saveCard, updateCardConfiguration, updateTheme, loadSavedCard } = window.CardSDK;
        const { unmount } = renderTapCard("card-sdk-id", {
          publicKey: "pk_test_zvsBYbu71Wxh0ZPtFSjr5OnK", // Tap's public key
          transaction: {
            currency: Currencies.SAR,
          },
          acceptance: {
            supportedBrands: ["AMERICAN_EXPRESS", "VISA", "MASTERCARD", "MADA"], // Remove the ones that are NOT enabled on your Tap account
            supportedCards: "ALL", // To accept both Debit and Credit
          },
          fields: {
            cardHolder: true,
          },
          addons: {
            displayPaymentBrands: true,
            loader: true,
            saveCard: true,
          },
          interface: {
            locale: Locale.AR,
            theme: Theme.LIGHT,
            edges: Edges.CURVED,
            direction: Direction.RTL,
          },
        //-   onReady: () => console.log("onReady"),
        //-   onFocus: () => console.log("onFocus"),
        //-   onBinIdentification: (data) => console.log("onBinIdentification", data),
        //-   onValidInput: (data) => console.log("onValidInputChange", data),
          //- onInvalidInput: (data) => console.log("onInvalidInput", data),
          onError: (data) => console.log("onError", data),
          onSuccess: (data) => {
            const requestId = "#{requestId}"
            const test = {...data, requestId}
            sendPaymentData(test);
            },
        });

        function sendPaymentData(data) {
          fetch('/api/v1/auth/payment-success', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          }).then((response) => response.json())
            .then((response) => window.open(response.transaction.url))
          .catch(error => {
            console.error('Error:', error);
          });
        }
      });
